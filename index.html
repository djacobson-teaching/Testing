<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CAD Match & Play — HTML (Shadow DOM)</title>
  <style>
    html,body{margin:0;padding:0}
    #mount{all:initial; display:block;}
  </style>
</head>
<body>
  <div id="mount"></div>

  <script>
  (function(){
    const host = document.getElementById('mount');
    const root = host.attachShadow({mode:'open'});

    const style = document.createElement('style');
    style.textContent = `
      :host{all:initial}
      *,*::before,*::after{box-sizing:border-box}
      body{margin:0}
      .container{max-width:1200px;margin:0 auto;padding:20px;font:16px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#e2e8f0;background:linear-gradient(120deg,#0f172a,#111827);min-height:100vh}
      h1{margin:0 0 6px;font-size:28px}
      .muted{color:#94a3b8}
      .row{display:grid;gap:16px}
      .row.cols{grid-template-columns:1fr}
      @media (min-width:900px){.row.cols{grid-template-columns:1.2fr .9fr .9fr}}
      .panel{background:rgba(255,255,255,.06);border:1px solid rgba(148,163,184,.25);border-radius:16px;padding:14px}
      .status{font-weight:600}
      .statgrid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
      .stat{background:rgba(255,255,255,.06);border:1px solid rgba(148,163,184,.25);border-radius:12px;padding:10px}
      .stat .label{color:#94a3b8;font-size:12px}
      .stat .value{font-size:22px;font-weight:800;color:#e2e8f0}
      .controls label{display:flex;justify-content:space-between;align-items:center;gap:8px;margin:8px 0;color:#e2e8f0}
      .controls select,.controls input[type="number"]{padding:6px 8px;border-radius:8px;border:1px solid #cbd5e1;background:#fff;color:#0f172a}
      .controls input[type="checkbox"]{width:18px;height:18px}
      .btn{cursor:pointer;border:none;border-radius:12px;padding:10px 14px;color:#fff;background:#0f172a;transition:.15s transform}
      .btn:active{transform:scale(.98)}
      .btn-prim{background:#0284c7}
      .btn-okay{background:#059669}
      .foot{display:flex;justify-content:space-between;align-items:center;margin:4px 0 10px;gap:8px;flex-wrap:wrap}

      .grid{display:grid;gap:12px;margin-top:16px;grid-template-columns:repeat(3,1fr)}
      @media(min-width:700px){.grid{grid-template-columns:repeat(4,1fr)}}
      @media(min-width:1100px){.grid{grid-template-columns:repeat(5,1fr)}}

      .card{position:relative;aspect-ratio:4/5;border-radius:16px;border:1px solid rgba(148,163,184,.35);box-shadow:0 10px 20px rgba(0,0,0,.2);overflow:hidden;background:linear-gradient(140deg,rgba(34,197,94,.85),rgba(6,182,212,.85));display:flex;align-items:center;justify-content:center}
      .card.back .badge{display:none}
      .face{position:absolute;inset:0;padding:12px 12px 10px 12px;display:flex;flex-direction:column;color:#0f172a;background:#fff}
      .cat{font-size:10px;text-transform:uppercase;color:#64748b}
      .badge{margin-top:4px;display:inline-flex;font-size:12px;background:#eef2ff;border:1px solid #c7d2fe;color:#1e293b;border-radius:999px;padding:3px 8px;width:max-content}
      .title{margin-top:6px;font-weight:700}
      .desc{margin-top:6px;font-size:14px;color:#334155}
      .hint{margin-top:auto;padding-top:4px;font-size:10px;color:#94a3b8}

      .progress{height:10px;background:rgba(255,255,255,.15);border-radius:999px;overflow:hidden}
      .bar{height:100%;background:linear-gradient(90deg,#06b6d4,#22c55e)}
    `;

    const wrap = document.createElement('div');
    wrap.className = 'container';
    wrap.innerHTML = `
      <div class="foot">
        <div>
          <h1>🎮 CAD Match & Play</h1>
          <div class="muted">Flip cards to match <b>Button Name</b> ↔ <b>Description</b>. Explain each match!</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="btnNew" class="btn">New game</button>
          <button id="btnStart" class="btn btn-okay">Apply & Start</button>
        </div>
      </div>
      <div class="row cols">
        <div class="panel">
          <div class="muted">Status</div>
          <div id="status" class="status">Find all the matches! Name ↔ Description</div>
          <div class="statgrid">
            <div class="stat"><div class="label">Moves</div><div id="moves" class="value">0</div></div>
            <div class="stat"><div class="label">Score</div><div id="score" class="value">0</div></div>
            <div class="stat"><div class="label">Streak</div><div id="streak" class="value">0</div></div>
            <div class="stat">
              <div class="label">Found</div>
              <div class="value"><span id="found">0</span>/<span id="total">0</span></div>
              <div class="progress" style="margin-top:6px"><div id="bar" class="bar" style="width:0%"></div></div>
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="muted">Settings</div>
          <div class="controls">
            <label><span>Pairs in deck</span>
              <select id="pairs"><option>6</option><option>8</option><option selected>10</option><option>12</option><option>14</option></select>
            </label>
            <label><span>Timer</span>
              <span>
                <input id="timerOn" type="checkbox" />
                <input id="timeLimit" type="number" min="30" max="999" value="180" style="width:80px" />
                <span class="muted">seconds</span>
              </span>
            </label>
            <label><span>Show discussion prompts</span><input id="showPrompts" type="checkbox" checked /></label>
            <label><span>Sound effects</span><input id="soundOn" type="checkbox" checked /></label>
            <div id="timerBox" class="stat" style="display:none;margin-top:8px">
              <div class="label">Time Left</div>
              <div id="timeLeft" class="value">180s</div>
              <div class="progress" style="margin-top:6px"><div id="tbar" class="bar" style="width:100%"></div></div>
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="muted">How to play (for students)</div>
          <ol style="margin-top:8px;padding-left:18px">
            <li>Flip a card to reveal either a <b>Button Name</b> or its <b>Description</b>.</li>
            <li>Flip a second card. If they match, you score points and keep the pair.</li>
            <li>After each match, explain how and when you’d use that tool.</li>
            <li>Beat the clock if the timer is on!</li>
          </ol>
        </div>
      </div>
      <div id="grid" class="grid" aria-live="polite"></div>
      <div class="foot">
        <div class="muted">Edit the term list in the <code>BASE_TERMS</code> array inside this file to customize.</div>
        <div class="muted">v1.1 • Shadow‑DOM</div>
      </div>
    `;

    root.appendChild(style);
    root.appendChild(wrap);

    const BASE_TERMS = [
      {name:"2 point centerline",description:"One of the tools for creating sheet geometry in Drawings, outside of a view and meant to represent some part of the 3D model. This tool creates a centerline between two points, including the end points on another 2-point linear centerline."},
      {name:"2 point circle centerline",description:"One of the tools for creating sheet geometry in Drawings, outside of a view and meant to represent some part of the 3D model. This tool creates a circular centerline using two points."},
      {name:"2 point linear dimension",description:"Allows you to place a dimension between any two points in a Drawing view."},
      {name:"3 point angular dimension",description:"Allows you to place an angular dimension between three points in a Drawing."},
      {name:"3 point arc",description:"A Sketch tool that enables you to sketch an arc by defining the two end points and then the radius point."},
      {name:"3 point circle",description:"A Sketch and Drawing tool that allows you to sketch a circle by defining three points along its circumference."},
      {name:"3 point circle centerline",description:"One of the tools for creating sheet geometry in Drawings, outside of a view and meant to represent some part of the 3D model. This tool creates a circular centerline for a circle diameter."},
      {name:"3D fit spline",description:"A Feature tool that enables you to create a spline through a series of vertices."},
      {name:"Abbe number",description:"Controls the approximate measure of the material's dispersion (change of refractive index versus wavelength)."},
      {name:"Accept command",description:"Records the actions taken in the dialog box and closes the box."},
      {name:"Add custom features",description:"Allows you to add a custom feature to your toolbar from a document version. Custom features are written in FeatureScript."},
      {name:"Aligned rectangle",description:"Sketch a rectangle, starting with a line and ending with the perpendicular distance of the aligned side."},
      {name:"Analysis tools",description:"A set of tools used to inspect design integrity of sketch edges/surfaces and part edges/surfaces/volumes in Part Studios, and instance surfaces/interferences in Assemblies."},
      {name:"Appearance panel",description:"A panel to assign a color to a feature (face, part, or sketch). Contains a color palette and mixer, options for saving custom colors, and tessellation quality controls for the selected face or part."},
      {name:"Aspect ratio",description:"Defines the render's aspect ratio between width and height. Options include: From View, 4x3, 16x9, and Custom."},
      {name:"Assembly circular pattern",description:"An Assembly tool used to pattern selected entities upon an axis."},
      {name:"Assembly linear pattern",description:"An Assembly tool used to pattern selected entities linearly."},
      {name:"Bend relief",description:"In a sheet metal model, the small cut made where the bend end meets a free edge."},
      {name:"Bezier",description:"A Sketch tool that enables you to create a multi‑point Bézier curve with points along its control polygon."},
      {name:"Boolean",description:"A Feature tool that enables you to modify parts by subtracting, intersecting, or merging parts or surfaces."},
      {name:"Bridging curve",description:"A Feature tool that enables you to create a curve connecting any two points or vertices."},
      {name:"Cancel command",description:"If a command is in progress, this cancels the command and reverts back to the state before the command was initiated."},
      {name:"Centermark",description:"Drawings tool that creates a symbol used to mark the center of a circle or partial circle. Also a visual treatment for Virtual sharps (centermark or edge extension)."},
      {name:"Center point arc",description:"A Sketch tool that enables you to sketch an arc by defining center, start, and end points."},
      {name:"Center point rectangle",description:"A Sketch and Drawing tool that enables you to sketch a rectangle starting with its center point."},
      {name:"Chamfer",description:"A Sketch and Feature tool that enables you to break sharp edges with a bevel; create beveled edges on selected edges or faces."},
      {name:"Chamfer dimension (Drawing)",description:"Allows you to place a note or dimensions on a chamfered edge in a drawing."},
      {name:"Concentric",description:"Make any point coincident with the center of an arc or circle by sharing a center point."},
      {name:"Conic",description:"Sketch an ellipse, parabola, or hyperbola by defining start, end, and control points, as well as a rho value."},
    ];

    const PROMPTS = [
      "In your own words, when would you use this?",
      "Compare this tool with a similar one—what's the key difference?",
      "Give a real example from a past or hypothetical project.",
      "Which constraints or settings matter most when using this?",
      "What mistake do beginners make with this tool? How do you avoid it?",
      "Where does this live in the UI? Can you locate it quickly?",
    ];

    const el = (sel)=>root.querySelector(sel);
    const grid = el('#grid');
    const movesEl = el('#moves');
    const scoreEl = el('#score');
    const streakEl = el('#streak');
    const foundEl = el('#found');
    const totalEl = el('#total');
    const barEl = el('#bar');
    const statusEl = el('#status');
    const timerBox = el('#timerBox');
    const timeLeftEl = el('#timeLeft');
    const tbarEl = el('#tbar');

    const pairsSel = el('#pairs');
    const timerOnSel = el('#timerOn');
    const timeLimitSel = el('#timeLimit');
    const showPromptsSel = el('#showPrompts');
    const soundOnSel = el('#soundOn');

    let deck=[], flipped=[], matched=new Set(), locked=false, moves=0, score=0, streak=0, startTs=0;
    let timer=null, secondsLeft=0;

    function shuffle(a){const arr=[...a]; for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];} return arr;}
    function uid(){return Math.random().toString(36).slice(2)+Date.now().toString(36)}

    function inferCategory(text){
      const t = (''+text).toLowerCase();
      if(t.includes('assembly')) return 'Assembly';
      if(t.includes('drawing')) return 'Drawing';
      if(t.includes('sheet metal')) return 'Sheet Metal';
      if(t.includes('render')) return 'Rendering';
      if(t.includes('material')) return 'Materials';
      if(t.includes('feature')) return 'Feature';
      if(t.includes('sketch')) return 'Sketch';
      return 'General';
    }

    function buildDeck(list, pairCount){
      const selected = shuffle(list).slice(0,pairCount);
      const cards=[];
      selected.forEach((p,idx)=>{
        const pairId = `pair_${idx}_${uid()}`;
        const category = inferCategory(p.name+' '+p.description);
        cards.push({id:uid(),pairId,face:'name',text:p.name,category});
        cards.push({id:uid(),pairId,face:'desc',text:p.description,category});
      });
      return shuffle(cards);
    }

    function beep(freq=660,dur=80,type='sine',gain=0.03){
      if(!soundOnSel.checked) return;
      const Ctx = window.AudioContext||window.webkitAudioContext; if(!Ctx) return;
      if(!beep.ctx) beep.ctx = new Ctx();
      const ctx = beep.ctx;
      const o = ctx.createOscillator(); const g = ctx.createGain();
      o.type=type; o.frequency.value=freq; g.gain.value=gain; o.connect(g); g.connect(ctx.destination);
      o.start(); o.stop(ctx.currentTime + dur/1000);
    }

    function setStatus(msg){ statusEl.textContent = msg; }
    function renderStats(){
      movesEl.textContent = moves; scoreEl.textContent = score; streakEl.textContent = streak;
      const pairsFound = matched.size/2; const totalPairs = +pairsSel.value; foundEl.textContent=pairsFound; totalEl.textContent=totalPairs; barEl.style.width = Math.min(100, Math.round((pairsFound/totalPairs)*100))+'%';
    }

    function renderGrid(){
      grid.innerHTML = '';
      deck.forEach(card=>{
        const flippedOn = flipped.includes(card.id) || matched.has(card.id);
        const btn = document.createElement('button');
        btn.className = 'card'+(flippedOn?'':' back');
        btn.setAttribute('aria-label','card');
        btn.disabled = matched.has(card.id) || locked;

        if(flippedOn){
          const face = document.createElement('div'); face.className='face';
          const cat = document.createElement('div'); cat.className='cat'; cat.textContent = card.category; face.appendChild(cat);
          const badge = document.createElement('div'); badge.className='badge'; badge.textContent = (card.face==='name'?'Name':'Description'); face.appendChild(badge);
          if(card.face==='name'){
            const t=document.createElement('div'); t.className='title'; t.textContent = card.text; face.appendChild(t);
          }else{
            const d=document.createElement('div'); d.className='desc'; d.textContent = card.text; face.appendChild(d);
          }
          const h=document.createElement('div'); h.className='hint'; h.textContent='Click another card to match'; face.appendChild(h);
          btn.appendChild(face);
        }else{
          btn.innerHTML = '<div style="position:absolute;inset:0;color:white;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:6px">            <div style="font-size:12px;opacity:.9;letter-spacing:.08em;text-transform:uppercase">'+card.category+'</div>            <div style="font-size:30px;font-weight:900;text-shadow:0 4px 10px rgba(0,0,0,.3)">CAD</div>            <div style="font-size:13px;opacity:.9">Match & Play</div></div>'
        }

        btn.addEventListener('click',()=>onFlip(card.id));
        grid.appendChild(btn);
      });
    }

    function resetGame(){
      deck = buildDeck(BASE_TERMS, +pairsSel.value);
      flipped=[]; matched=new Set(); locked=false; moves=0; score=0; streak=0; startTs=Date.now(); secondsLeft=+timeLimitSel.value;
      renderGrid(); renderStats(); setStatus('Find all the matches! Name ↔ Description');
      if(timerOnSel.checked){ startTimer(); } else { stopTimer(); }
    }

    function startTimer(){ timerBox.style.display='block'; updateTimerUI(); stopTimer(); timer = setInterval(()=>{ secondsLeft=Math.max(0,secondsLeft-1); updateTimerUI(); if(secondsLeft===0){ stopTimer(); endByTime(); }},1000); }
    function stopTimer(){ if(timer){clearInterval(timer); timer=null} timerBox.style.display = timerOnSel.checked?'block':'none'; }
    function updateTimerUI(){ timeLeftEl.textContent=secondsLeft+'s'; const lim=+timeLimitSel.value; tbarEl.style.width=Math.round((secondsLeft/lim)*100)+'%'; }
    function endByTime(){ setStatus('⏰ Time! Great effort—try again or adjust settings.'); beep(200,300,'sawtooth',0.05); locked=true; }

    function onFlip(id){
      if(locked) return; const card = deck.find(c=>c.id===id); if(!card) return; if(matched.has(id) || flipped.includes(id)) return;
      beep(720,50);
      flipped.push(id); renderGrid();
      if(flipped.length===2){
        locked=true; moves++; renderStats();
        const [aId,bId]=flipped; const a=deck.find(c=>c.id===aId); const b=deck.find(c=>c.id===bId);
        const isMatch = a && b && a.pairId===b.pairId && a.face!==b.face;
        setTimeout(()=>{
          if(isMatch){
            beep(1020,80,'square',0.05); setTimeout(()=>beep(1220,80,'square',0.04),90);
            matched.add(aId); matched.add(bId); streak++; score += 100 + Math.min(5,streak)*20;
            if(showPromptsSel.checked){ const prompt = PROMPTS[Math.floor(Math.random()*PROMPTS.length)]; setStatus('✅ Match! '+(a.face==='name'?a.text:b.text)+' — '+prompt); } else { setStatus('✅ Match!'); }
          }else{
            beep(260,100,'sawtooth',0.04); setTimeout(()=>beep(200,120,'sawtooth',0.035),80);
            streak=0; score=Math.max(0,score-10);
          }
          flipped=[]; locked=false; renderGrid(); renderStats();
          const pairsFound = matched.size/2; const totalPairs = +pairsSel.value;
          if(pairsFound===totalPairs){
            if(timer) stopTimer();
            const elapsed = Math.round((Date.now()-startTs)/1000);
            setStatus(`🎉 All pairs matched! Moves: ${moves} • Score: ${score} • Time: ${elapsed}s`);
            beep(880,120,'triangle',0.06); setTimeout(()=>beep(1040,120,'triangle',0.06),140);
          }
        }, 500);
      }
    }

    wrap.querySelector('#btnNew').addEventListener('click', resetGame);
    wrap.querySelector('#btnStart').addEventListener('click', resetGame);
    timerOnSel.addEventListener('change', ()=>{ if(timerOnSel.checked){ startTimer(); } else { stopTimer(); } });
    resetGame();
  })();
  </script>
</body>
</html>
